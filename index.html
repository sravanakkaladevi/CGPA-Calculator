<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Report Card - CGPA Calculator</title>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        background-color: #faf0d8;
        padding: 30px;
        color: #333;
      }

      .page-wrapper {
        max-width: 900px;
        margin: 0 auto;
      }

      .report-card {
        background: white;
        border: 2px solid #111111;
        padding: 40px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .header-section {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 2px solid #edc987;
        padding-bottom: 20px;
      }

      .header-section h1 {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .header-section p {
        font-size: 12px;
        color: #666;
        margin: 3px 0;
      }

      .student-info {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 30px;
        background: #fefcf5;
        padding: 20px;
        border: 1px solid #ddd;
      }

      .info-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dotted #ddd;
      }

      .info-label {
        font-weight: bold;
        color: #333;
        min-width: 100px;
        background-color: #fefcf5;
        padding: 5px;
      }

      .info-value {
        color: #333;
      }

      .input-field {
        border: 1px solid #999;
        border-radius: 3px;
        padding: 8px;
        width: 100%;
        background: white;
        font-family: Arial;
        font-size: 13px;
      }

      .input-field:focus {
        outline: none;
        border: 1px solid #edc987;
        background-color: #fffef5;
      }

      .grades-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 25px;
        border: 2px solid #111111;
      }

      .grades-table thead {
        background: #edc987;
        color: #333;
      }

      .grades-table th {
        padding: 12px;
        text-align: center;
        font-weight: bold;
        font-size: 13px;
        border: 1px solid #111111;
      }

      .grades-table td {
        padding: 12px;
        text-align: center;
        border: 1px solid #ddd;
        font-size: 13px;
      }

      .grades-table tbody tr:nth-child(even) {
        background: #fefcf5;
      }

      .grades-table tbody tr:hover {
        background: #f5f0e8;
      }

      .semester-header {
        background: #edc987;
        color: #333;
        font-weight: bold;
        border: 1px solid #111111;
      }

      .semester-header td {
        padding: 10px;
      }

      .grade-select {
        padding: 6px 10px;
        border: 1px solid #999;
        border-radius: 3px;
        background: white;
        color: #333;
        font-weight: bold;
        cursor: pointer;
        font-size: 13px;
      }

      .grade-select:focus {
        outline: none;
        border-color: #edc987;
        background-color: #fffef5;
      }

      .result-section {
        background: linear-gradient(135deg, #edc987, #d4b878);
        color: #333;
        padding: 25px;
        border: 2px solid #111111;
        text-align: center;
        margin-bottom: 25px;
        display: none;
      }

      .result-section.show {
        display: block;
      }

      .result-value {
        font-size: 48px;
        font-weight: bold;
        margin-bottom: 10px;
        color: #2d5016;
      }

      .result-label {
        font-size: 16px;
        color: #333;
      }

      .result-section.fail {
        background: linear-gradient(135deg, #ffcccc, #ff9999);
        border-color: #dc2626;
      }

      .result-section.fail .result-value {
        color: #c33;
      }

      .summary-section {
        background: #fefcf5;
        border: 2px solid #111111;
        padding: 20px;
        margin-bottom: 25px;
        display: none;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
      }

      .summary-item {
        text-align: center;
        padding: 15px;
        background: white;
        border: 1px solid #ddd;
      }

      .summary-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 8px;
        text-transform: uppercase;
        font-weight: bold;
      }

      .summary-value {
        font-size: 24px;
        font-weight: bold;
        color: #333;
      }

      .button-group {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 30px 0;
      }

      button {
        padding: 12px 20px;
        font-size: 14px;
        font-weight: bold;
        border: 1px solid #111111;
        border-radius: 4px;
        cursor: pointer;
        transition: 0.3s;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        background: white;
      }

      #calculateBtn {
        background: #edc987;
        color: #333;
      }

      #calculateBtn:hover {
        background: #d4b878;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      #downloadBtn {
        background: #edc987;
        color: #333;
      }

      #downloadBtn:hover {
        background: #d4b878;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      }

      .footer {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px solid #edc987;
        color: #666;
        font-size: 11px;
      }

      .remarks-section {
        margin-top: 25px;
        padding: 20px;
        background: #fefcf5;
        border: 1px solid #ddd;
        display: none;
      }

      .remarks-label {
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
      }

      .remarks-text {
        border: 1px solid #ddd;
        padding: 10px;
        min-height: 60px;
        background: white;
        color: #333;
        font-size: 13px;
        line-height: 1.6;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: white;
        border: 2px solid #111111;
        padding: 30px;
        width: 95%;
        max-width: 900px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #edc987;
        padding-bottom: 15px;
      }

      .modal-header h2 {
        color: #333;
        margin: 0;
        font-size: 20px;
      }

      .modal-close {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
        padding: 0;
        width: 40px;
        height: 40px;
      }

      .modal-close:hover {
        color: #333;
      }

      .pdf-preview {
        background: #fefcf5;
        border: 1px solid #ddd;
        padding: 20px;
        margin-bottom: 20px;
      }

      .modal-footer {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        border-top: 1px solid #ddd;
        padding-top: 15px;
      }

      .modal-footer button {
        padding: 10px 20px;
        font-size: 13px;
        border: 1px solid #999;
        border-radius: 4px;
        cursor: pointer;
        background: white;
      }

      .btn-cancel:hover {
        background: #f5f5f5;
      }

      .btn-download {
        background: #edc987;
        border-color: #111111;
      }

      .btn-download:hover {
        background: #d4b878;
      }

      .target-section {
        display: none;
        margin-top: 30px;
        padding: 20px;
        background: #fefcf5;
        border: 2px solid #111111;
      }

      .target-section h3 {
        margin: 0 0 15px 0;
        color: #333;
        font-size: 16px;
      }

      .target-section p {
        margin: 0 0 15px 0;
        color: #666;
        font-size: 13px;
      }

      #targetResult {
        display: none;
        margin-top: 15px;
        padding: 15px;
        background: white;
        border-left: 4px solid #edc987;
      }

      .sem34-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }

      .sem34-card {
        background: white;
        padding: 15px;
        border-left: 4px solid #edc987;
        border-radius: 3px;
        border: 1px solid #ddd;
      }

      .sem34-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        font-size: 13px;
      }

      .sem34-value {
        font-size: 20px;
        font-weight: bold;
        color: #2d5016;
        margin-bottom: 5px;
      }

      .sem34-description {
        font-size: 11px;
        color: #666;
        line-height: 1.4;
      }

      .alert-box {
        padding: 12px;
        border-radius: 3px;
        margin-top: 15px;
        font-size: 12px;
        line-height: 1.5;
      }

      .alert-warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        color: #856404;
      }

      .alert-success {
        background: #d4edda;
        border-left: 4px solid #28a745;
        color: #155724;
      }

      .alert-danger {
        background: #f8d7da;
        border-left: 4px solid #dc3545;
        color: #721c24;
      }

      .alert-info {
        background: #d1ecf1;
        border-left: 4px solid #17a2b8;
        color: #0c5460;
      }

      @media (max-width: 768px) {
        .report-card {
          padding: 20px;
        }

        .student-info {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .summary-grid {
          grid-template-columns: 1fr;
        }

        .button-group {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="page-wrapper">
      <div class="report-card">
        <!-- Header -->
        <div class="header-section">
          <h1>MCA-CBCS-2-YEARS CGPA CALCULATOR</h1>
          <p>Osmania University - Report Card</p>
          <p style="font-size: 11px; margin-top: 8px; color: #000080">
            A. Sravan Kumar School
          </p>
        </div>

        <!-- Student Info -->
        <div class="student-info">
          <div>
            <div class="info-row">
              <span class="info-label">Student Name:</span>
              <input
                type="text"
                class="input-field"
                id="studentName"
                placeholder="Enter name"
              />
            </div>
            <div class="info-row">
              <span class="info-label">Roll No:</span>
              <input
                type="text"
                class="input-field"
                id="rollNo"
                placeholder="Enter roll no"
              />
            </div>
          </div>
          <div>
            <div class="info-row">
              <span class="info-label">Semester:</span>
              <select
                id="semesterSelect"
                class="input-field"
                onchange="updateSubjects()"
              >
                <option value="">-- Select --</option>
                <option value="all">All Semesters (1-4)</option>
              </select>
            </div>
            <div class="info-row">
              <span class="info-label">Report Date:</span>
              <input type="date" class="input-field" id="reportDate" />
            </div>
          </div>
        </div>

        <!-- Grades Table -->
        <table class="grades-table">
          <thead>
            <tr>
              <th style="width: 10%">Sub Code</th>
              <th style="width: 50%">Subject Name</th>
              <th style="width: 10%">Credits</th>
              <th style="width: 20%">Grade Secured</th>
            </tr>
          </thead>
          <tbody id="rows">
            <tr>
              <td
                colspan="4"
                style="text-align: center; padding: 20px; color: #999"
              >
                Please select a semester
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Result Section -->
        <div id="result" class="result-section">
          <div class="result-value" id="resultValue"></div>
          <div class="result-label" id="resultLabel"></div>
        </div>

        <!-- Summary Section -->
        <div class="summary-section" id="summarySection">
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-label">Total Subjects</div>
              <div class="summary-value" id="totalSubjects">0</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">Total Credits</div>
              <div class="summary-value" id="totalCredits">0</div>
            </div>
            <div class="summary-item">
              <div class="summary-label">Performance</div>
              <div class="summary-value" id="performance">-</div>
            </div>
          </div>
        </div>

        <!-- Remarks -->
        <div class="remarks-section" id="remarksSection">
          <div class="remarks-label">Remarks / Comments:</div>
          <div class="remarks-text" id="remarksText"></div>
        </div>

        <!-- Target CGPA Calculator -->
        <div class="target-section" id="targetSection">
          <h3>Semester 3 & 4 Target CGPA Calculator</h3>
          <p>
            Enter your target CGPA to see what scores you need in semesters 3 &
            4
          </p>

          <div
            style="
              display: flex;
              gap: 10px;
              align-items: center;
              flex-wrap: wrap;
            "
          >
            <label style="font-weight: bold; color: #333">Target CGPA:</label>
            <input
              type="number"
              id="targetCGPA"
              placeholder="e.g., 8.5"
              min="5"
              max="10"
              step="0.1"
              style="
                padding: 8px;
                border: 1px solid #999;
                border-radius: 3px;
                width: 120px;
              "
            />
            <button
              onclick="calculateTargetScore()"
              style="
                padding: 8px 20px;
                background: #edc987;
                color: #333;
                border: 1px solid #111111;
                border-radius: 3px;
                cursor: pointer;
                font-weight: bold;
              "
            >
              Calculate
            </button>
          </div>

          <div id="targetResult">
            <p
              id="targetMessage"
              style="margin: 0; color: #333; line-height: 1.6"
            ></p>
          </div>
        </div>

        <!-- Buttons -->
        <div class="button-group">
          <button id="calculateBtn" onclick="calculate()">
            Calculate CGPA
          </button>
          <button id="downloadBtn" onclick="downloadPDF()">
            Download Report
          </button>
        </div>

        <!-- Footer -->
        <div class="footer">
          <p>
            ¬© School Report Card System | Generated on:
            <span id="footerDate"></span>
          </p>
        </div>
      </div>
    </div>

    <!-- PDF Preview Modal -->
    <div id="pdfModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üìÑ Report Card Preview</h2>
          <button class="modal-close" onclick="closePDFModal()">‚úï</button>
        </div>
        <div class="modal-body">
          <div class="pdf-preview" id="pdfPreview"></div>
        </div>
        <div class="modal-footer">
          <button class="btn-cancel" onclick="closePDFModal()">Cancel</button>
          <button class="btn-download" onclick="finalDownloadPDF()">
            Download PDF
          </button>
        </div>
      </div>
    </div>

    <!-- jsPDF Library with autoTable plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <script>
      // Set current date
      document.getElementById("footerDate").textContent =
        new Date().toLocaleDateString();

      // Set default report date to today
      document.getElementById("reportDate").valueAsDate = new Date();

      const subjectsBySemester = {
        1: [
          {
            code: "R24PCC101",
            name: "Mathematical Foundations of Computer Science",
            credits: 4,
          },
          { code: "R24PCC102", name: "Data Structures using C", credits: 4 },
          {
            code: "R24PCC103",
            name: "Object Oriented Programming using Java",
            credits: 4,
          },
          { code: "R24PCC104", name: "Computer Architecture", credits: 4 },
          { code: "R24PCC105", name: "Probability and Statistics", credits: 4 },
          {
            code: "R24MGC106",
            name: "Managerial Economics and Accountancy",
            credits: 4,
          },

          {
            code: "R24LCC151",
            name: "Data Structures using C Lab",
            credits: 1.5,
          },
          { code: "R24LCC152", name: "Java Programming Lab", credits: 1.5 },
          { code: "R24HSCI151", name: "Soft Skills Lab", credits: 1.5 },
        ],

        2: [
          { code: "R24PCC201", name: "Operating Systems", credits: 4 },
          {
            code: "R24PCC202",
            name: "Database Management Systems",
            credits: 4,
          },
          {
            code: "R24PCC203",
            name: "Design and Analysis of Algorithms",
            credits: 4,
          },
          {
            code: "R24PCC204",
            name: "Data Engineering with Python",
            credits: 4,
          },
          { code: "R24PCC205", name: "Machine Learning", credits: 4 },
          { code: "R24MGC206", name: "Operations Research", credits: 4 },

          { code: "R24LCC251", name: "Operating Systems Lab", credits: 1.5 },
          {
            code: "R24LCC252",
            name: "Data Engineering with Python Lab",
            credits: 1.5,
          },
          {
            code: "R24LCC253",
            name: "Database Management Systems Lab",
            credits: 1.5,
          },
        ],

        3: [
          { code: "PCC301", name: "Software Engineering", credits: 4 },
          { code: "PCC302", name: "Computer Networks", credits: 4 },
          { code: "PCC303", name: "Artificial Intelligence", credits: 4 },
          { code: "PCC304", name: "Full Stack Development", credits: 4 },

          { code: "PEC312", name: "Distributed Systems", credits: 3 },
          { code: "PEC321", name: "Network Security", credits: 3 },

          { code: "LCC351", name: "Computer Networks Lab", credits: 1.5 },
          { code: "LCC352", name: "Software Engineering Lab", credits: 1.5 },
          { code: "LCC353", name: "Full Stack Development Lab", credits: 1.5 },

          { code: "SIP321", name: "Summer Internship", credits: 1.5 },
        ],

        4: [
          { code: "P1", name: "Elective/Subject 1", credits: 3 },
          { code: "P2", name: "Elective" - 2, credits: 3 },
          { code: "P3", name: "Elective-3", credits: 2 },

          { code: "PROJ401", name: "Project Work", credits: 12 },
        ],
      };

      let subjects = [];
      const points = { S: 10, A: 9, B: 8, C: 7, D: 6, E: 5, F: 0 };

      // Update subjects based on selected semester
      function updateSubjects() {
        const semesterSelect = document.getElementById("semesterSelect").value;
        const rows = document.getElementById("rows");

        if (!semesterSelect) {
          rows.innerHTML =
            "<tr><td colspan='4' style='text-align: center; padding: 20px; color: #999;'>Please select semesters</td></tr>";
          return;
        }

        rows.innerHTML = "";
        let rowIndex = 0;

        // Show all semesters combined
        for (let sem = 1; sem <= 4; sem++) {
          // Add semester header with Calculate button
          rows.innerHTML += `
            <tr class="semester-header">
              <td colspan="3" style="text-align: left;">Semester ${sem}</td>
              <td style="text-align: center;">
                <button onclick="calculateSemester(${sem})" style="padding: 5px 10px; background: #EDC987; color: #333; border: 1px solid #111111; border-radius: 3px; cursor: pointer; font-size: 12px; font-weight: bold;">Calculate</button>
              </td>
            </tr>
          `;

          subjectsBySemester[sem].forEach((s) => {
            rows.innerHTML += `
              <tr>
                <td>${s.code}</td>
                <td style="text-align: left;">${s.name}</td>
                <td>${s.credits}</td>
                <td>
                  <select class="grade-select" id="g${rowIndex}" onchange="updatePreview()">
                    <option value="">Select</option>
                    <option>S</option>
                    <option>A</option>
                    <option>B</option>
                    <option>C</option>
                    <option>D</option>
                    <option>E</option>
                    <option>F</option>
                  </select>
                </td>
              </tr>
            `;
            rowIndex++;
          });
        }
        subjects = [];
        for (let sem = 1; sem <= 4; sem++) {
          subjects = subjects.concat(subjectsBySemester[sem]);
        }

        // Show target section
        document.getElementById("targetSection").style.display = "block";
      }

      function updatePreview() {
        // Real-time preview update
      }

      function calculateTargetScore() {
        const targetCGPA = parseFloat(
          document.getElementById("targetCGPA").value
        );

        if (!targetCGPA || targetCGPA < 5 || targetCGPA > 10) {
          alert("Please enter a valid target CGPA between 5 and 10");
          return;
        }

        // Calculate sem 1 & 2 totals
        let sem12Total = 0,
          sem12PointsTotal = 0;

        for (let sem = 1; sem <= 2; sem++) {
          let semIdx = 0;
          for (let s = 1; s < sem; s++) {
            semIdx += subjectsBySemester[s].length;
          }

          subjectsBySemester[sem].forEach((s) => {
            const grade = document.getElementById(`g${semIdx}`).value;
            if (grade && grade !== "F") {
              sem12Total += s.credits;
              sem12PointsTotal += s.credits * points[grade];
            }
            semIdx++;
          });
        }

        if (sem12Total === 0) {
          alert("Please enter grades for semesters 1 & 2 first");
          return;
        }

        // Calculate individual semester CGPAs
        let sem1Total = 0,
          sem1Points = 0;
        let sem2Total = 0,
          sem2Points = 0;

        // Semester 1
        subjectsBySemester[1].forEach((s, idx) => {
          const grade = document.getElementById(`g${idx}`).value;
          if (grade && grade !== "F") {
            sem1Total += s.credits;
            sem1Points += s.credits * points[grade];
          }
        });

        // Semester 2
        let sem2Idx = subjectsBySemester[1].length;
        subjectsBySemester[2].forEach((s) => {
          const grade = document.getElementById(`g${sem2Idx}`).value;
          if (grade && grade !== "F") {
            sem2Total += s.credits;
            sem2Points += s.credits * points[grade];
          }
          sem2Idx++;
        });

        // Calculate sem 3 & 4 requirements
        let sem34Total = 0;
        for (let sem = 3; sem <= 4; sem++) {
          subjectsBySemester[sem].forEach((s) => {
            sem34Total += s.credits;
          });
        }

        // Formula: targetCGPA = (sem12Points + sem34Points) / (sem12Total + sem34Total)
        // sem34Points = targetCGPA * (sem12Total + sem34Total) - sem12PointsTotal
        const requiredPoints =
          targetCGPA * (sem12Total + sem34Total) - sem12PointsTotal;
        const requiredGPA = requiredPoints / sem34Total;

        // Calculate current CGPA
        const currentCGPA = (sem12PointsTotal / sem12Total).toFixed(2);

        // Build message
        let message = ``;

        // Current Performance Section
        message += `<div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 3px;">`;
        message += `<strong style="font-size: 13px; color: #333; display: block; margin-bottom: 10px;">üìä YOUR CURRENT PERFORMANCE (Sem 1 & 2)</strong>`;
        message += `<div class="sem34-grid">`;

        // Semester 1
        const sem1CGPA =
          sem1Total > 0 ? (sem1Points / sem1Total).toFixed(2) : "N/A";
        message += `<div class="sem34-card">`;
        message += `<div class="sem34-title">Semester 1</div>`;
        message += `<div class="sem34-value">${sem1CGPA}</div>`;
        message += `<div class="sem34-description">Credits: ${sem1Total.toFixed(
          1
        )}</div>`;
        message += `</div>`;

        // Semester 2
        const sem2CGPA =
          sem2Total > 0 ? (sem2Points / sem2Total).toFixed(2) : "N/A";
        message += `<div class="sem34-card">`;
        message += `<div class="sem34-title">Semester 2</div>`;
        message += `<div class="sem34-value">${sem2CGPA}</div>`;
        message += `<div class="sem34-description">Credits: ${sem2Total.toFixed(
          1
        )}</div>`;
        message += `</div>`;

        message += `</div>`;

        // Overall current
        message += `<div style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 3px; text-align: center;">`;
        message += `<div style="font-size: 11px; color: #666;">Sem 1 & 2 Combined CGPA</div>`;
        message += `<div style="font-size: 18px; font-weight: bold; color: #333;">${currentCGPA}</div>`;
        message += `</div>`;
        message += `</div>`;

        // Target and Requirement Section
        message += `<div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 3px;">`;
        message += `<strong style="font-size: 13px; color: #333; display: block; margin-bottom: 10px;">üéØ YOUR TARGET</strong>`;
        message += `<div style="text-align: center; padding: 10px; background: white; border-radius: 3px; margin-bottom: 10px;">`;
        message += `<div style="font-size: 11px; color: #666;">Target CGPA</div>`;
        message += `<div style="font-size: 22px, font-weight: bold; color: #2d5016;">${targetCGPA}</div>`;
        message += `</div>`;

        // Sem 3 & 4 Requirement
        message += `<div style="padding: 10px; background: #f0f0f0; border-radius: 3px; text-align: center;">`;
        message += `<div style="font-size: 11px; color: #666; margin-bottom: 5px;">Required GPA for Sem 3 & 4</div>`;
        message += `<div style="font-size: 18px; font-weight: bold; color: #2d5016;">${requiredGPA.toFixed(
          2
        )}</div>`;
        message += `<div style="font-size: 10px; color: #999; margin-top: 5px;">Out of 10.0</div>`;
        message += `</div>`;
        message += `</div>`;

        // Semester 3 & 4 Breakdown
        message += `<div style="margin-bottom: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 3px;">`;
        message += `<strong style="font-size: 13px; color: #333; display: block; margin-bottom: 10px;">üìö SEMESTER 3 & 4 BREAKDOWN</strong>`;
        message += `<div class="sem34-grid">`;

        // Sem 3
        let sem3Total = 0;
        subjectsBySemester[3].forEach((s) => {
          sem3Total += s.credits;
        });
        message += `<div class="sem34-card">`;
        message += `<div class="sem34-title">Semester 3</div>`;
        message += `<div class="sem34-description">Total Credits: <strong>${sem3Total.toFixed(
          1
        )}</strong><br>Subjects: <strong>${
          subjectsBySemester[3].length
        }</strong></div>`;
        message += `</div>`;

        // Sem 4
        let sem4Total = 0;
        subjectsBySemester[4].forEach((s) => {
          sem4Total += s.credits;
        });
        message += `<div class="sem34-card">`;
        message += `<div class="sem34-title">Semester 4</div>`;
        message += `<div class="sem34-description">Total Credits: <strong>${sem4Total.toFixed(
          1
        )}</strong><br>Subjects: <strong>${
          subjectsBySemester[4].length
        }</strong></div>`;
        message += `</div>`;

        message += `</div>`;
        message += `</div>`;

        // Grade Equivalent
        let gradeNeeded = "";
        let gradeDescription = "";
        if (requiredGPA >= 9.5) {
          gradeNeeded = "S+ (Exceptional)";
          gradeDescription = "Nearly perfect performance required";
        } else if (requiredGPA >= 9) {
          gradeNeeded = "S (Excellent)";
          gradeDescription = "Excellent performance needed";
        } else if (requiredGPA >= 8) {
          gradeNeeded = "A (Very Good)";
          gradeDescription = "Very good performance needed";
        } else if (requiredGPA >= 7) {
          gradeNeeded = "B (Good)";
          gradeDescription = "Good performance needed";
        } else if (requiredGPA >= 6) {
          gradeNeeded = "C (Satisfactory)";
          gradeDescription = "Satisfactory performance needed";
        } else if (requiredGPA >= 5) {
          gradeNeeded = "D (Pass)";
          gradeDescription = "Pass needed";
        } else {
          gradeNeeded = "E (Below Pass)";
          gradeDescription = "Below passing grade";
        }

        // Alert Section
        if (requiredGPA > 10) {
          message += `<div class="alert-box alert-danger">`;
          message += `<strong>‚ö†Ô∏è TARGET NOT ACHIEVABLE</strong><br>`;
          message += `Your target CGPA of ${targetCGPA} is <strong>impossible to achieve</strong> with your current Semester 1 & 2 performance (${currentCGPA}).`;
          message += `<br><br><strong>Alternative Path:</strong> The highest possible CGPA you can achieve is <strong>${(
            (sem12PointsTotal + sem34Total * 10) /
            (sem12Total + sem34Total)
          ).toFixed(2)}</strong> (if you score S in all Sem 3 & 4 subjects).`;
          message += `</div>`;
        } else if (requiredGPA > 9.5) {
          message += `<div class="alert-box alert-warning">`;
          message += `<strong>‚ö†Ô∏è EXTREMELY CHALLENGING TARGET</strong><br>`;
          message += `You need an average of <strong>${requiredGPA.toFixed(
            2
          )} / 10</strong> in Sem 3 & 4 (${gradeNeeded}). This requires <strong>nearly perfect performance</strong> with minimal room for error.`;
          message += `<br><br><strong>Realistic Alternative:</strong> Aim for CGPA <strong>${Math.max(
            5,
            (
              (sem12PointsTotal + sem34Total * 9) /
              (sem12Total + sem34Total)
            ).toFixed(2)
          )}</strong> which requires S/A grades in Sem 3 & 4.`;
          message += `</div>`;
        } else if (requiredGPA > 9) {
          message += `<div class="alert-box alert-warning">`;
          message += `<strong>‚ö†Ô∏è VERY CHALLENGING TARGET</strong><br>`;
          message += `You need an average of <strong>${requiredGPA.toFixed(
            2
          )} / 10</strong> (${gradeNeeded}). Mostly S and occasional A grades required.`;
          message += `<br><br><strong>Success Rate:</strong> Possible but requires consistent excellence in all Sem 3 & 4 subjects.`;
          message += `</div>`;
        } else if (requiredGPA > 8) {
          message += `<div class="alert-box alert-info">`;
          message += `<strong>‚ÑπÔ∏è CHALLENGING TARGET</strong><br>`;
          message += `You need an average of <strong>${requiredGPA.toFixed(
            2
          )} / 10</strong> (${gradeNeeded}). Mix of A and B grades required.`;
          message += `<br><br><strong>Recommendation:</strong> Focus on consistent performance in all subjects.`;
          message += `</div>`;
        } else if (requiredGPA > 7) {
          message += `<div class="alert-box alert-success">`;
          message += `<strong>‚úì ACHIEVABLE TARGET</strong><br>`;
          message += `You need an average of <strong>${requiredGPA.toFixed(
            2
          )} / 10</strong> (${gradeNeeded}). Good performance with some B grades acceptable.`;
          message += `<br><br><strong>Action Plan:</strong> Study consistently and aim for B+ to A grades in Sem 3 & 4.`;
          message += `</div>`;
        } else {
          message += `<div class="alert-box alert-success">`;
          message += `<strong>‚úì EASILY ACHIEVABLE TARGET</strong><br>`;
          message += `You need an average of <strong>${requiredGPA.toFixed(
            2
          )} / 10</strong> (${gradeNeeded}). Moderate effort required.`;
          message += `<br><br><strong>Outlook:</strong> This target is very realistic and achievable with regular study.`;
          message += `</div>`;
        }

        // Final CGPA Calculation
        const overallCGPA = (
          (sem12PointsTotal + requiredPoints) /
          (sem12Total + sem34Total)
        ).toFixed(2);

        message += `<div style="margin-top: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 3px;">`;
        message += `<strong style="font-size: 13px; color: #333; display: block; margin-bottom: 10px;">üìà FINAL RESULT (All 4 Semesters)</strong>`;
        message += `<div style="text-align: center; padding: 15px; background: linear-gradient(135deg, #edc987, #d4b878); border-radius: 3px;">`;
        message += `<div style="font-size: 11px; color: #333; margin-bottom: 5px;">Overall CGPA if you achieve target in Sem 3 & 4</div>`;
        message += `<div style="font-size: 28px; font-weight: bold; color: #2d5016;">${overallCGPA}</div>`;
        message += `</div>`;
        message += `</div>`;

        document.getElementById("targetResult").style.display = "block";
        document.getElementById("targetMessage").innerHTML = message;
      }

      function calculateSemester(semNum) {
        let semTotal = 0,
          semPointsTotal = 0,
          semCount = 0,
          semFailed = false;

        // Calculate starting index for this semester
        let startIdx = 0;
        for (let s = 1; s < semNum; s++) {
          startIdx += subjectsBySemester[s].length;
        }

        // Calculate CGPA for specific semester
        subjectsBySemester[semNum].forEach((s, idx) => {
          const grade = document.getElementById(`g${startIdx + idx}`).value;

          if (!grade) return;

          semCount++;

          if (grade === "F") {
            semFailed = true;
            return;
          }

          semTotal += s.credits;
          semPointsTotal += s.credits * points[grade];
        });

        if (semCount === 0) {
          alert(`Please enter grades for Semester ${semNum}`);
          return;
        }

        if (semFailed) {
          alert(
            `Semester ${semNum} has a failed grade. Please retake the course.`
          );
          return;
        }

        const semCGPA = (semPointsTotal / semTotal).toFixed(2);
        let gradeRange = "";

        if (semCGPA >= 9) gradeRange = "Excellent (A+)";
        else if (semCGPA >= 8) gradeRange = "Very Good (A)";
        else if (semCGPA >= 7) gradeRange = "Good (B)";
        else if (semCGPA >= 6) gradeRange = "Satisfactory (C)";
        else if (semCGPA >= 5) gradeRange = "Pass (D)";
        else gradeRange = "Need Improvement";

        // Show result
        document.getElementById("result").classList.remove("fail");
        document.getElementById("result").classList.add("show");
        document.getElementById("resultValue").textContent = semCGPA;
        document.getElementById(
          "resultLabel"
        ).textContent = `${gradeRange} - Semester ${semNum}`;

        // Show summary
        document.getElementById("summarySection").style.display = "block";
        document.getElementById("totalSubjects").textContent = semCount;
        document.getElementById("totalCredits").textContent =
          semTotal.toFixed(1);
        document.getElementById("performance").textContent = gradeRange;

        // Show remarks
        document.getElementById("remarksSection").style.display = "block";
        let remarks = "";
        if (semCGPA >= 9)
          remarks = "Outstanding performance! Keep up the excellent work.";
        else if (semCGPA >= 8)
          remarks =
            "Excellent performance. Continue to maintain this standard.";
        else if (semCGPA >= 7)
          remarks = "Good performance. Strive to improve further.";
        else if (semCGPA >= 6)
          remarks = "Satisfactory performance. More effort is required.";
        else if (semCGPA >= 5)
          remarks = "Passed. Extra effort and focus needed.";
        else remarks = "Performance needs significant improvement.";
        document.getElementById("remarksText").textContent = remarks;
      }

      function calculate() {
        // Calculate CGPA for all semesters
        calculateBySemester();
      }

      function calculateBySemester() {
        let allResultsHTML = `<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">`;
        let overallTotal = 0,
          overallPointsTotal = 0;
        let hasAnyData = false;

        for (let sem = 1; sem <= 4; sem++) {
          let semTotal = 0,
            semPointsTotal = 0,
            semCount = 0,
            semFailed = false;

          subjectsBySemester[sem].forEach((s, idx) => {
            // Calculate overall row index for all semesters
            let globalIdx = 0;
            for (let s = 1; s < sem; s++) {
              globalIdx += subjectsBySemester[s].length;
            }
            globalIdx += idx;

            const grade = document.getElementById(`g${globalIdx}`).value;
            if (!grade) return;

            semCount++;
            hasAnyData = true;

            if (grade === "F") {
              semFailed = true;
              return;
            }

            semTotal += s.credits;
            semPointsTotal += s.credits * points[grade];
          });

          if (semCount > 0) {
            overallTotal += semTotal;
            overallPointsTotal += semPointsTotal;

            if (semFailed) {
              allResultsHTML += `
                <div style="background: #fee; border: 2px solid #c33; padding: 15px; border-radius: 3px; text-align: center;">
                  <p style="margin: 0 0 10px 0; font-weight: bold; color: #c33;">Semester ${sem}</p>
                  <p style="margin: 0; font-size: 16px; font-weight: bold; color: #c33;">FAILED</p>
                  <p style="margin: 5px 0 0 0; font-size: 11px; color: #666;">Retake required</p>
                </div>
              `;
            } else {
              const semCGPA = (semPointsTotal / semTotal).toFixed(2);
              let semGrade = "";
              if (semCGPA >= 9) semGrade = "A+";
              else if (semCGPA >= 8) semGrade = "A";
              else if (semCGPA >= 7) semGrade = "B";
              else if (semCGPA >= 6) semGrade = "C";
              else if (semCGPA >= 5) semGrade = "D";
              else semGrade = "E";

              allResultsHTML += `
                <div style="background: #FEFCF5; border: 2px solid #EDC987; padding: 15px; border-radius: 3px; text-align: center;">
                  <p style="margin: 0 0 10px 0; font-weight: bold; color: #333;">Semester ${sem}</p>
                  <p style="margin: 0; font-size: 22px; font-weight: bold; color: #333;">${semCGPA}</p>
                  <p style="margin: 5px 0 0 0; font-size: 11px; color: #666;">Grade: ${semGrade}</p>
                </div>
              `;
            }
          }
        }

        allResultsHTML += `</div>`;

        if (!hasAnyData) {
          document.getElementById("result").classList.remove("show");
          document.getElementById("summarySection").style.display = "none";
          document.getElementById("remarksSection").style.display = "none";
          return;
        }

        // Show overall result
        if (overallTotal > 0) {
          const overallCGPA = (overallPointsTotal / overallTotal).toFixed(2);
          let gradeRange = "";
          let remarks = "";

          if (overallCGPA >= 9) {
            gradeRange = "Excellent (A+)";
            remarks = "Outstanding performance across all semesters!";
          } else if (overallCGPA >= 8) {
            gradeRange = "Very Good (A)";
            remarks = "Excellent overall performance. Keep it up!";
          } else if (overallCGPA >= 7) {
            gradeRange = "Good (B)";
            remarks = "Good performance. Continue to improve.";
          } else if (overallCGPA >= 6) {
            gradeRange = "Satisfactory (C)";
            remarks = "Satisfactory overall performance.";
          } else if (overallCGPA >= 5) {
            gradeRange = "Pass (D)";
            remarks = "Passed overall. More focus needed.";
          } else {
            gradeRange = "Need Improvement";
            remarks = "Overall performance needs improvement.";
          }

          const resultDiv = document.getElementById("result");
          resultDiv.classList.remove("fail");
          resultDiv.classList.add("show");
          document.getElementById("resultValue").textContent = overallCGPA;
          document.getElementById("resultLabel").textContent = gradeRange;

          document.getElementById("summarySection").style.display = "block";
          document.getElementById("totalSubjects").textContent = "All";
          document.getElementById("totalCredits").textContent = "See below";
          document.getElementById("performance").textContent = gradeRange;
          // Show semester results
          document.getElementById("remarksSection").style.display = "block";
          document.getElementById("remarksText").innerHTML =
            allResultsHTML +
            `<p style="margin-top: 15px; text-align: center; font-style: italic; color: #666;">${remarks}</p>`;
        }
      }

      // PDF Report (Professional School-Style Report Card)
      function downloadPDF() {
        const studentName =
          document.getElementById("studentName").value || "Student";
        const rollNo = document.getElementById("rollNo").value || "N/A";
        const resultText = document.getElementById("resultValue").textContent;

        if (!resultText || resultText.trim() === "") {
          alert("Please calculate CGPA first before downloading the report.");
          return;
        }

        // Generate preview HTML
        generatePDFPreview(studentName, rollNo);

        // Show modal
        document.getElementById("pdfModal").classList.add("show");
      }

      function generatePDFPreview(studentName, rollNo) {
        const reportDate =
          document.getElementById("reportDate").value ||
          new Date().toLocaleDateString();
        const resultValue = document.getElementById("resultValue").textContent;
        const resultLabel = document.getElementById("resultLabel").textContent;
        const remarksText =
          document.getElementById("remarksText").textContent || "No remarks";

        let tableRows = "";
        if (subjects.length > 0) {
          subjects.forEach((s, i) => {
            const grade = document.getElementById(`g${i}`).value || "-";
            tableRows += `
              <tr>
                <td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 12px;">${s.code}</td>
                <td style="border: 1px solid #ddd; padding: 10px; text-align: left; font-size: 12px;">${s.name}</td>
                <td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-size: 12px;">${s.credits}</td>
                <td style="border: 1px solid #ddd; padding: 10px; text-align: center; font-weight: bold; color: #333; font-size: 12px;">${grade}</td>
              </tr>
            `;
          });
        }

        const previewHTML = `
          <div style="background: white; padding: 25px; border: 2px solid #111111; border-radius: 3px;">
            <div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #EDC987; padding-bottom: 15px;">
              <h1 style="color: #333; margin: 0; font-size: 24px;">REPORT CARD</h1>
              <p style="color: #666; margin: 5px 0; font-size: 12px;">Osmania University - MCA | A. Sravan Kumar School</p>
            </div>

            <div style="margin-bottom: 20px; background: #FEFCF5; padding: 15px; border: 1px solid #ddd;">
              <table style="width: 100%; font-size: 13px;">
                <tr>
                  <td style="padding: 5px 0;"><strong>Student Name:</strong> ${studentName}</td>
                  <td style="padding: 5px 0;"><strong>Roll No:</strong> ${rollNo}</td>
                </tr>
                <tr>
                  <td style="padding: 5px 0;"><strong>Date:</strong> ${reportDate}</td>
                  <td style="padding: 5px 0;"></td>
                </tr>
              </table>
            </div>

            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; border: 2px solid #111111;">
              <thead>
                <tr style="background: #EDC987; color: #333;">
                  <th style="border: 1px solid #111111; padding: 10px; font-weight: bold; font-size: 12px;">Sub Code</th>
                  <th style="border: 1px solid #111111; padding: 10px; font-weight: bold; font-size: 12px;">Subject Name</th>
                  <th style="border: 1px solid #111111; padding: 10px; font-weight: bold; font-size: 12px;">Credits</th>
                  <th style="border: 1px solid #111111; padding: 10px; font-weight: bold; font-size: 12px;">Grade</th>
                </tr>
              </thead>
              <tbody>
                ${tableRows}
              </tbody>
            </table>

            <div style="background: linear-gradient(135deg, #EDC987, #d4b878); color: #333; padding: 20px; border: 2px solid #111111; margin-bottom: 20px; text-align: center;">
              <p style="margin: 0; font-size: 13px;">CGPA Score</p>
              <p style="margin: 10px 0; font-size: 32px; font-weight: bold;">${resultValue}</p>
              <p style="margin: 0; font-size: 13px;">Performance: ${resultLabel}</p>
            </div>

            <div style="background: #FEFCF5; padding: 15px; border-radius: 3px; border: 1px solid #ddd;">
              <p style="margin: 0 0 8px 0; color: #333; font-weight: bold; font-size: 12px;">Remarks / Comments:</p>
              <p style="margin: 0; color: #333; line-height: 1.5; font-size: 12px;">${remarksText}</p>
            </div>

            <div style="text-align: center; margin-top: 20px; border-top: 1px solid #ddd; padding-top: 10px; font-size: 10px; color: #999;">
              ¬© School Report Card System | Generated on: ${new Date().toLocaleString()}
            </div>
          </div>
        `;

        document.getElementById("pdfPreview").innerHTML = previewHTML;
      }

      function closePDFModal() {
        document.getElementById("pdfModal").classList.remove("show");
      }

      function finalDownloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF("p", "mm", "a4");

        const studentName =
          document.getElementById("studentName").value || "Student";
        const rollNo = document.getElementById("rollNo").value || "N/A";
        const reportDate =
          document.getElementById("reportDate").value ||
          new Date().toLocaleDateString();

        doc.setFontSize(18);
        doc.setTextColor(51, 51, 51);
        doc.text("REPORT CARD", 105, 20, { align: "center" });

        doc.setFontSize(10);
        doc.setTextColor(100, 100, 100);
        doc.text("Osmania University - MCA | A. Sravan Kumar School", 105, 27, {
          align: "center",
        });

        doc.setFontSize(11);
        doc.setTextColor(0, 0, 0);
        doc.text(`Student Name: ${studentName}`, 20, 40);
        doc.text(`Roll No: ${rollNo}`, 110, 40);
        doc.text(`Date: ${reportDate}`, 20, 47);

        const tableData = [];
        if (subjects.length > 0) {
          subjects.forEach((s, i) => {
            const grade = document.getElementById(`g${i}`).value || "-";
            tableData.push([s.code, s.name, s.credits.toString(), grade]);
          });
        }

        if (tableData.length > 0) {
          doc.autoTable({
            head: [["Sub Code", "Subject Name", "Credits", "Grade"]],
            body: tableData,
            startY: 55,
            margin: 20,
            headStyles: {
              fillColor: [237, 201, 135],
              textColor: [51, 51, 51],
              fontStyle: "bold",
            },
            bodyStyles: {
              textColor: [0, 0, 0],
            },
            alternateRowStyles: {
              fillColor: [254, 252, 245],
            },
          });

          const resultText = document.getElementById("resultValue").textContent;
          const resultLabel =
            document.getElementById("resultLabel").textContent;
          const remarksText =
            document.getElementById("remarksText").textContent || "No remarks";

          if (resultText && resultText !== "") {
            const yPosition = doc.lastAutoTable.finalY + 15;

            doc.setFontSize(13);
            doc.setTextColor(51, 51, 51);
            doc.text("CGPA:", 20, yPosition);

            doc.setFontSize(14);
            doc.setTextColor(51, 51, 51);
            doc.text(resultText, 50, yPosition);

            doc.setFontSize(10);
            doc.setTextColor(100, 100, 100);
            doc.text(`Performance: ${resultLabel}`, 20, yPosition + 10);

            doc.setFontSize(11);
            doc.setTextColor(51, 51, 51);
            doc.text("Remarks:", 20, yPosition + 20);

            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            const splitRemarks = doc.splitTextToSize(remarksText, 170);
            doc.text(splitRemarks, 20, yPosition + 27);
          }
        }

        doc.setFontSize(9);
        doc.setTextColor(150, 150, 150);
        doc.text(
          "¬© School Report Card System | Generated on: " +
            new Date().toLocaleString(),
          105,
          285,
          { align: "center" }
        );

        doc.save(`Report_Card_${studentName}.pdf`);
        closePDFModal();
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("pdfModal");
        if (event.target === modal) {
          closePDFModal();
        }
      };
    </script>
  </body>
</html>
